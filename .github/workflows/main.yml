#!/bin/bash
# deploy.sh - Manual deployment script

echo "ğŸš€ Starting deployment..."

# Pull latest changes
echo "ğŸ“¥ Pulling latest changes from GitHub..."
git pull origin main

# Build and start containers
echo "ğŸ³ Building and starting Docker containers..."
docker-compose down
docker-compose up -d --build

# Wait for services to be ready
echo "â³ Waiting for services to start..."
sleep 30

# Run Laravel commands
echo "ğŸ¯ Running Laravel commands..."
docker-compose exec -T app php artisan config:cache
docker-compose exec -T app php artisan route:cache
docker-compose exec -T app php artisan view:cache
docker-compose exec -T app php artisan migrate --force

# Restart containers to ensure everything is fresh
echo "ğŸ”„ Restarting containers..."
docker-compose restart

echo "âœ… Deployment completed successfully!"
echo "ğŸŒ Application is available at: http://159.223.47.2"

---

#!/bin/bash
# setup-vps.sh - Initial VPS setup script

echo "ğŸ”§ Setting up VPS for Laravel deployment..."

# Update system
echo "ğŸ“¦ Updating system packages..."
apt update && apt upgrade -y

# Install Docker
echo "ğŸ³ Installing Docker..."
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
rm get-docker.sh

# Install Docker Compose
echo "ğŸ”¨ Installing Docker Compose..."
apt install docker-compose -y

# Install Git
echo "ğŸ“š Installing Git..."
apt install git -y

# Install other useful tools
echo "ğŸ› ï¸ Installing additional tools..."
apt install htop curl wget unzip -y

# Create application directory
echo "ğŸ“ Creating application directory..."
mkdir -p /var/www/restaurant
cd /var/www/restaurant

# Clone repository
echo "ğŸ“¥ Cloning repository..."
git clone https://github.com/Rofiqii/restaurant.git .

# Set permissions
echo "ğŸ” Setting permissions..."
chmod -R 755 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache

# Create .env file
echo "âš™ï¸ Creating environment file..."
cp .env.example .env

# Setup firewall
echo "ğŸ”¥ Configuring firewall..."
ufw allow ssh
ufw allow 80
ufw allow 443
ufw allow 8000
ufw allow 3000  # Grafana
ufw allow 3001  # Uptime Kuma
ufw --force enable

echo "âœ… VPS setup completed!"
echo "ğŸ”— Next steps:"
echo "1. Update GitHub Secrets with your SSH key"
echo "2. Push your code to trigger GitHub Actions"
echo "3. Visit http://159.223.47.2:8000 to see your application"

---

#!/bin/bash
# health-check.sh - Application health check script

echo "ğŸ¥ Performing health check..."

# Check if containers are running
echo "ğŸ³ Checking Docker containers..."
docker-compose ps

# Check application response
echo "ğŸŒ Checking application response..."
curl -f http://localhost:8000 >/dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ… Application is responding"
else
    echo "âŒ Application is not responding"
fi

# Check database connection
echo "ğŸ—„ï¸ Checking database connection..."
docker-compose exec -T app php artisan migrate:status

# Check logs for errors
echo "ğŸ“‹ Checking for recent errors..."
docker-compose logs --tail=20 app | grep -i error

echo "ğŸ¥ Health check completed!"